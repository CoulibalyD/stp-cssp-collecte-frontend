<div class="form-builder card">
  <div class="card-header">
    <h3>Création de formulaire</h3>
  </div>
  <div class="card-body">
    <!-- Informations générales -->
    <div class="row mb-3">
      <div class="col-md-4">
        <select [(ngModel)]="newForm.activiteId" class="form-control">
          <option [value]="0">-- Lier à une activité --</option>
          <option *ngFor="let a of activites" [value]="a.id">{{ a.title }}</option>
        </select>
      </div>
      <div class="col-md-4">
        <input [(ngModel)]="newForm.title" placeholder="Titre du formulaire" class="form-control">
      </div>
      <div class="col-md-4">
        <input [(ngModel)]="newForm.description" placeholder="Description" class="form-control">
      </div>
    </div>

    <h5>Questions</h5>

    <!-- Liste des champs -->
    <div *ngFor="let field of newForm.fields; let i = index" class="field-item border p-3 mb-3 rounded">
      <div class="d-flex gap-2 mb-2 align-items-start">
        <span class="badge bg-secondary">{{ i+1 }}</span>
        <input [(ngModel)]="field.label" placeholder="Libellé de la question" class="form-control">
        <select [(ngModel)]="field.type" class="form-control" style="min-width:180px">
          <option *ngFor="let t of fieldTypes" [value]="t.value">{{ t.label }}</option>
        </select>
        <div class="form-check">
          <input type="checkbox" [(ngModel)]="field.isRequired" class="form-check-input" [id]="'req'+i">
          <label class="form-check-label" [for]="'req'+i">Obligatoire</label>
        </div>
        <button class="btn btn-danger btn-sm" (click)="removeField(i)">Supprimer</button>
      </div>

      <!-- Options additionnelles selon le type -->
      <div class="ms-4 mt-2 p-2 bg-light rounded">
        <!-- Placeholder pour TEXT, TEXTAREA, EMAIL, TEL -->
        <div *ngIf="['TEXT', 'TEXTAREA', 'EMAIL', 'TEL'].includes(field.type)" class="mb-2">
          <label>Placeholder :</label>
          <input [(ngModel)]="field.placeholder" class="form-control form-control-sm">
        </div>

        <!-- Rows pour TEXTAREA -->
        <div *ngIf="field.type === 'TEXTAREA'" class="mb-2">
          <label>Nombre de lignes :</label>
          <input type="number" [(ngModel)]="field.rows" class="form-control form-control-sm" min="1" max="20">
        </div>

        <!-- Min/Max/Step pour NUMBER -->
        <div *ngIf="field.type === 'NUMBER'" class="row g-2">
          <div class="col">
            <label>Min</label>
            <input type="number" [(ngModel)]="field.min" class="form-control form-control-sm">
          </div>
          <div class="col">
            <label>Max</label>
            <input type="number" [(ngModel)]="field.max" class="form-control form-control-sm">
          </div>
          <div class="col">
            <label>Step</label>
            <input type="number" [(ngModel)]="field.step" class="form-control form-control-sm" step="any">
          </div>
        </div>

        <!-- Options pour DROPDOWN et RADIO -->
        <div *ngIf="['DROPDOWN', 'RADIO', 'CHECKBOX', 'MULTI_SELECT'].includes(field.type)">
          <h6>Options de réponse</h6>
          <div *ngFor="let opt of field.options; let j = index" class="d-flex gap-2 mb-1">
            <input [(ngModel)]="opt.label" placeholder="Texte affiché (Label)" class="form-control form-control-sm">
            <input [(ngModel)]="opt.value" placeholder="Valeur stockée (ex: YES)" class="form-control form-control-sm">
            <button class="btn btn-sm btn-outline-danger" (click)="removeOption(field, j)">X</button>
          </div>
          <button class="btn btn-sm btn-outline-info mt-1" (click)="addOption(field)">+ Ajouter une option</button>
        </div>
      </div>
    </div>

    <!-- Boutons d'action -->
    <div class="d-flex justify-content-between">
      <button class="btn btn-outline-primary" (click)="addField()">+ Ajouter une question</button>
      <button class="btn btn-success" (click)="saveForm()">Enregistrer le formulaire</button>
    </div>
  </div>
</div>
